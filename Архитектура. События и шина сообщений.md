> Общее правило таково: если вы не можете описать работу функции, не используя такие слова как "затем" или "и", то, скорее всего, нарушаете принцип единой ответственности

Одна из формулировок указанного принципа заключается в том, что каждый класс должен иметь только одну причину для изменения

События - это некоторое действие, произошедшее в системе
Шина сообщений - это по сути место, в котором для каждого события выбирается его обработчик. Шиной он называется потому, что туда попадают все события и он в зависимости от его типа выбирает нужный обработчик

Это очередная абстракция, которая позволяет нам легко тестировать, а также масштабировать наш код. Ну и самое главное - мы соблюдаем букву S в SOLID - что немаловажно для масштабируемой и поддерживаемой системы

Вот один из простых примеров реализации паттерна.
![[Screenshot 2025-06-19 at 19.17.48.png]]
Здесь у нас создается ABC с методами commit и publish_events - commit() вызывается при каждой post работе с бд, что позволяет нам туда засунуть множество дополнительных действий (в рамках SOLID), что как раз мы и сделали - мы туда добавляем publish_events(), которая как раз таки и вызывает наш messagebus (шину сообщений)
![[Screenshot 2025-06-19 at 19.20.03.png]]
А вот и сама реализация messagebus - довольно примитивная но при этом немаловажная и дико помогающая в тестировании и обеспечении абстракций
Здесь мы видим функцию handle - это как раз то место, в котором для приходящего event (события) вызывается соответствующий для него handler (обработчик). В данном случае у нас есть лишь 1 event - это OutOfStock, для которого мы ставим отправку нотификации на почту. Мы можем завтра добавить помимо нотификации на почту нотификацию на СМС или звонок, неважно - мы теперь полностью абстрагировали эту логику от моделей, сервисного слоя, репозитория итд - все это делается в messagebus

[[Архитектура]] [[IT]]