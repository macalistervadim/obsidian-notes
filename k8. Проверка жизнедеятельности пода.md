# Liveness –∏ Readiness Probes –≤ Kubernetes

> –ê–Ω–∞–ª–æ–≥–∏—á–Ω—ã `healthcheck` –≤ Docker Compose, **–Ω–æ —Å –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω—ã–º–∏ –æ—Ç–ª–∏—á–∏—è–º–∏**. –í Kubernetes –æ–Ω–∏ –Ω–∞–ø—Ä—è–º—É—é –≤–ª–∏—è—é—Ç –Ω–∞ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –∫–ª–∞—Å—Ç–µ—Ä–∞: –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤, –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—é —Ç—Ä–∞—Ñ–∏–∫–∞ –∏ –ø–ª–∞–≤–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è ‚Äî –≤—Å—ë —ç—Ç–æ –∑–∞–≤—è–∑–∞–Ω–æ –Ω–∞ —Ä–∞–±–æ—Ç–µ –ø—Ä–æ–±.

## –ó–∞—á–µ–º —ç—Ç–æ –Ω—É–∂–Ω–æ?

–ü—Ä–æ–±—ã ‚Äî –∫–ª—é—á–µ–≤–æ–π –º–µ—Ö–∞–Ω–∏–∑–º –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è **–±–µ—Å—à–æ–≤–Ω–æ—Å—Ç–∏ (zero-downtime)** –∏ **—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏** —Å–∏—Å—Ç–µ–º—ã –ø—Ä–∏:

- –°—Ç–∞—Ä—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- –û–±–Ω–æ–≤–ª–µ–Ω–∏—è—Ö (Rolling Updates)
- –í—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å–±–æ—è—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∞ –ë–î)

–ë–µ–∑ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã—Ö –ø—Ä–æ–± Kubernetes –º–æ–∂–µ—Ç:

- –ù–∞–ø—Ä–∞–≤–ª—è—Ç—å —Ç—Ä–∞—Ñ–∏–∫ –≤ –µ—â—ë –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–¥
- –ù–µ –∑–∞–º–µ—á–∞—Ç—å ¬´–∑–∞–≤–∏—Å—à–∏–π¬ª –ø—Ä–æ—Ü–µ—Å—Å
- –ü—Ä–æ–¥–æ–ª–∂–∞—Ç—å –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –∑–∞–ø—Ä–æ—Å—ã –≤ —Å–ª–æ–º–∞–Ω–Ω—ã–π —Å–µ—Ä–≤–∏—Å

---

## –î–≤–∞ —Ç–∏–ø–∞ –ø—Ä–æ–±

### `readinessProbe` ‚Äî –≥–æ—Ç–æ–≤ –ª–∏ –ø—Ä–∏–Ω–∏–º–∞—Ç—å —Ç—Ä–∞—Ñ–∏–∫?

- **–¶–µ–ª—å**: –∏—Å–∫–ª—é—á–∏—Ç—å –ø–æ–¥ –∏–∑ –ø—É–ª–∞ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏ —Ç—Ä–∞—Ñ–∏–∫–∞ (Service), –ø–æ–∫–∞ –æ–Ω –Ω–µ –≥–æ—Ç–æ–≤.
- **–ü–æ–≤–µ–¥–µ–Ω–∏–µ –ø—Ä–∏ –ø—Ä–æ–≤–∞–ª–µ**:  
    ‚Üí –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä **–Ω–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è**  
    ‚Üí –ü–æ–¥ **–Ω–µ –ø–æ–ø–∞–¥–∞–µ—Ç –≤ Endpoints** —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–≥–æ Service  
    ‚Üí –û–±–Ω–æ–≤–ª–µ–Ω–∏—è (`RollingUpdate`) **–∂–¥—É—Ç**, –ø–æ–∫–∞ –Ω–æ–≤—ã–π –ø–æ–¥ —Å—Ç–∞–Ω–µ—Ç ready
- **–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è**: –ø—Ä–æ–≥—Ä–µ–≤–∞ –∫—ç—à–∞, –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î, –º–∏–≥—Ä–∞—Ü–∏–π –∏ —Ç.–ø.

### `livenessProbe` ‚Äî –∂–∏–≤ –ª–∏ –ø—Ä–æ—Ü–µ—Å—Å?

- **–¶–µ–ª—å**: –æ–±–Ω–∞—Ä—É–∂–∏—Ç—å ¬´–∑–∞–≤–∏—Å—à–µ–µ¬ª —Å–æ—Å—Ç–æ—è–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –Ω–µ –ª–µ—á–∏—Ç—Å—è —Å–∞–º–æ.
- **–ü–æ–≤–µ–¥–µ–Ω–∏–µ –ø—Ä–∏ –ø—Ä–æ–≤–∞–ª–µ**:  
    ‚Üí –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä **–ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è** (–∫–∞–∫ `docker restart`)
- **–û—Å—Ç–æ—Ä–æ–∂–Ω–æ!** –°–ª–∏—à–∫–æ–º –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ ‚Üí —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏–µ —Ä–µ—Å—Ç–∞—Ä—Ç—ã –∑–¥–æ—Ä–æ–≤–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

> üí° **–ü—Ä–∞–≤–∏–ª–æ**:  
> `readinessProbe` ‚Äî –¥–ª—è **–≤—Ä–µ–º–µ–Ω–Ω–æ–π –Ω–µ–≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏**,  
> `livenessProbe` ‚Äî —Ç–æ–ª—å–∫–æ –¥–ª—è **—Ä–µ–∞–ª—å–Ω—ã—Ö –∑–∞–≤–∏—Å–∞–Ω–∏–π**.

---

## –û—Ç–ª–∏—á–∏—è –æ—Ç Docker Compose `healthcheck`

| –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å                | Docker Compose | k8                                    |
| -------------------------- | -------------- | ------------------------------------- |
| –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ—Å—Ç–∞—Ä—Ç     | ‚ùå              | ‚úÖ (`livenessProbe`)                   |
| –£–¥–∞–ª–µ–Ω–∏–µ –∏–∑ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏   | ‚ùå              | ‚úÖ (`readinessProbe`)                  |
| –í–ª–∏—è–Ω–∏–µ –Ω–∞ Rolling Updates | ‚ùå              | ‚úÖ (–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∂–¥—ë—Ç¬†`ready`—Å—Ç–∞—Ç—É—Å)     |
| –ì–∏–±–∫–æ—Å—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏         | –ë–∞–∑–æ–≤–∞—è        | –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è (—Ä–∞–∑–Ω—ã–µ —Ç–∞–π–º–∞—É—Ç—ã, –ø–æ—Ä–æ–≥–∏) |


---

## –ü—Ä–∏–º–µ—Ä: `readinessProbe`

```yaml
readinessProbe:
  initialDelaySeconds: 15   # –ñ–¥–∞—Ç—å 15 —Å–µ–∫ –ø–æ—Å–ª–µ —Å—Ç–∞—Ä—Ç–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
  periodSeconds: 30         # –ü—Ä–æ–≤–µ—Ä—è—Ç—å –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫
  timeoutSeconds: 2         # –ú–∞–∫—Å. –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –æ—Ç–≤–µ—Ç–∞
  failureThreshold: 1       # –°–∫–æ–ª—å–∫–æ —Ä–∞–∑ –º–æ–∂–µ—Ç —É–ø–∞—Å—Ç—å –ø–µ—Ä–µ–¥ "–Ω–µ–≥–æ—Ç–æ–≤"
  successThreshold: 1       # –°–∫–æ–ª—å–∫–æ —É—Å–ø–µ—à–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤ ‚Äî —á—Ç–æ–±—ã —Å—á–∏—Ç–∞—Ç—å –≥–æ—Ç–æ–≤—ã–º
  httpGet:
    path: /health
    port: 8000
    scheme: HTTP
```

> üìå **–í–∞–∂–Ω–æ**: `/health` –¥–æ–ª–∂–µ–Ω –ø—Ä–æ–≤–µ—Ä—è—Ç—å **—Ä–µ–∞–ª—å–Ω—É—é –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å**:
> - –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –ë–î / –∫—ç—à–∞ / –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
> - –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
> - –ù–∞–ª–∏—á–∏–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö

```python
# –ü—Ä–∏–º–µ—Ä —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞ –Ω–∞ FastAPI
@app.get("/health")
def health():
    if not database.is_connected():
        raise HTTPException(status_code=503, detail="DB not ready")
    return {"status": "ok"}
```

---

## ‚ö†Ô∏è –ß—Ç–æ —á–∞—Å—Ç–æ —É–ø—É—Å–∫–∞—é—Ç

> [!warning]  
> –ü—Ä–æ–±–∞ –Ω–∞ `/health` ‚Äî —ç—Ç–æ **–º–∏–Ω–∏–º—É–º**. –û–Ω–∞ –≥–æ–≤–æ—Ä–∏—Ç –ª–∏—à—å: _¬´–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –∑–∞–ø—É—â–µ–Ω –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 200¬ª_.  
> –ù–æ:
> 
> - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ª–∏ –æ–Ω **–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ**?
> - –†–∞–±–æ—Ç–∞—é—Ç –ª–∏ **–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã** –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è?
> - –ù–µ ¬´–æ—Ç–≤–∞–ª–∏–ª–∏—Å—å¬ª –ª–∏ **–º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã-–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**?
> 
> –î–ª—è –ø–æ–ª–Ω–æ–π —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ –Ω—É–∂–Ω—ã:
> 
> - **–°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–µ health checks** (–ø—Ä–æ–≤–µ—Ä–∫–∞ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏)
> - **–¢—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞** –∏ **–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** –æ—à–∏–±–æ–∫ –≤ –ø—Ä–æ–º–∞—Ö–∞—Ö –ø—Ä–æ–±—ã
> - **–û—Ç–¥–µ–ª—å–Ω—ã–π —ç–Ω–¥–ø–æ–∏–Ω—Ç –¥–ª—è liveness** (–∏–Ω–æ–≥–¥–∞ –ø—Ä–æ—â–µ, —á–µ–º readiness)

---

## –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Ä—É—á–Ω—É—é?

```bash
# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å—Ç–∞—Ç—É—Å –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏
kubectl get pods

# –í –∫–æ–ª–æ–Ω–∫–µ READY: 0/1 ‚Üí readinessProbe –Ω–µ –ø—Ä–æ—à–ª–∞

# –î–µ—Ç–∞–ª–∏ —Å —Å–æ–±—ã—Ç–∏—è–º–∏
kubectl describe pod <pod-name>

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å, –≤–∫–ª—é—á—ë–Ω –ª–∏ –ø–æ–¥ –≤ Service
kubectl get endpoints <service-name>
```
## –°–º. —Ç–∞–∫–∂–µ

- [[k8]]
- [[IT]]
- [[Kubernetes Deployment]]
- [[Zero-downtime Deployment]]